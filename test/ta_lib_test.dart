import 'package:ta_lib/ta_lib.dart';
import 'package:test/test.dart';

void main() {
  group('TA-Lib', () {
    final taLib = TaLib();

    // setUp(() {
    //   // Additional setup goes here.
    // });

    test('ATR', () {
      expect(
          taLib.atr([
            46.78,
            47.32,
            47.45,
            47.20,
            47.86,
            47.90,
            48.23,
            47.90,
            47.56,
            47.45,
            47.67,
            47.69,
            48.67,
            47.99,
            48.32,
          ], [
            46.34,
            46.64,
            46.43,
            46.83,
            47.20,
            47.27,
            47.34,
            47.23,
            46.34,
            46.34,
            46.43,
            46.83,
            47.20,
            47.47,
            47.47,
          ], [
            46.43,
            46.87,
            46.76,
            46.92,
            47.23,
            47.49,
            47.34,
            47.43,
            46.83,
            46.47,
            46.56,
            47.32,
            47.53,
            47.78,
            47.63,
          ], timePeriod: 14),
          [
            0.932857142857143,
          ]);
    });

    test('BBANDS', () {
      final actual = taLib.bbands([
        1.04,
        1.04023,
        1.03994,
        1.03904,
        1.03963,
        1.03965,
        1.03958,
        1.03902,
        1.0395,
        1.03916,
        1.03963,
        1.03943,
        1.03909,
        1.04022,
        1.04046,
        1.03913,
        1.03872,
        1.03882,
        1.03909,
        1.03912,
      ], maType: MaType.sma, timePeriod: 20);
      expect(
        actual.lowerBand,
        [1.0385018748801262],
      );
      expect(
        actual.middleBand,
        [1.0394730000000003],
      );
      expect(
        actual.upperBand,
        [1.0404441251198744],
      );
    });

    test('MA', () {
      expect(taLib.ma([1, 2, 3, 4, 5], maType: MaType.sma, timePeriod: 3),
          [2, 3, 4]);
    });

    test('MACD', () {
      final (:macd, :macdSignal, :macdHist) = taLib.macd(
        [
          818724.000,
          821250.000,
          819260.000,
          819282.000,
          819765.000,
          820000.000,
          819500.000,
          820000.000,
          820000.000,
          820301.000,
          821388.000,
          819546.000,
          820441.000,
          821528.000,
          820928.000,
          820032.000,
          819646.000,
          819647.000,
          820250.000,
          820258.000,
          821337.000,
          820213.000,
          821369.000,
          821369.000,
          820245.000,
          821332.000,
          820305.000,
          821392.000,
          820290.000,
          821530.000,
          821530.000,
          820244.000,
          820286.000,
          819648.000,
          819646.000,
          819648.000,
          819850.000,
          819648.000,
          819647.000,
          819646.000,
        ],
      );
      expect(macd, [
        97.60097619506996,
        19.785526246996596,
        -41.24692629056517,
        -72.48036430391949,
        -112.23897967848461,
        -142.18958739726804,
        -164.11454116669483,
      ]);
      expect(macdHist, [
        -139.410705354802,
        -173.78092424230027,
        -187.85070142388963,
        -175.26731154979515,
        -172.02074153948823,
        -161.57707940661732,
        -146.8016265408353,
      ]);
      expect(
        macdSignal,
        [
          237.01168154987195,
          193.56645048929687,
          146.60377513332446,
          102.78694724587567,
          59.78176186100361,
          19.387492009349273,
          -17.31291462585955,
        ],
      );
    });

    test('TRANGE', () {
      expect(
          taLib.trange([
            1.03959,
            1.03936,
            1.03928,
            1.03916,
          ], [
            1.0387,
            1.03831,
            1.03864,
            1.03908,
          ], [
            1.03872,
            1.03882,
            1.03909,
            1.03912,
          ]),
          [
            0.0010499999999999954,
            0.0006399999999999739,
            0.00008000000000008001,
          ]);
    });
  });
}
